<!DOCTYPE html>

<html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="../libs/js/react-libs-cdn.js"></script>
      <link href="../libs/css/bulma-cdn.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <style>
        html,body { height:100%; }
        #main {
            background-color:whitesmoke;
            max-width: 900px;
            margin: 0 auto;
            min-height: 100%;
            position: relative
        }
        #content {
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            padding-top: 3.2rem;
        }
        #footer {
            position: absolute;
            bottom: 0;
            width: 100%;
        }
    </style>

    <html>
        <div id="main">
            <div id="header"></div>
            
            <div id="content"></div>

            <div id="footer"></div>
        </div>
    </html>     

    <script type="text/babel">
        
        class HearSection extends React.Component {
            render() {
                return (
                    <div>
                        <div className="hero is-primary">
                            <div className="hero-body">
                                <div className="has-text-centered">
                                    <h1 className="title">
                                        Screen Size Calculator
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class SreenSizeInput extends React.Component {
            constructor(props) {
                super(props);
                this.handleChange = this.handleChange.bind(this);
            }

            handleChange(e) {
                this.props.onSizeChange(e.target.value);
            }

            render() {
                return (
                    <div className="columns is-gapless">
                        <div className="colume">
                            <label className="label">The Screen Size:</label>
                            <input className="input" type="text" placeholder="Input the size in inch" onChange={this.handleChange}/>
                        </div>
                    </div>
                );
            }
        }

        class ScreenSizeRatioInput extends React.Component {
            constructor(props) {
                super(props);
                this.handleChange = this.handleChange.bind(this);
            }

            handleChange(e) {
                if(e.target.name == "width") {
                    this.props.onRatiochange(e.target.value, null);
                }
                if(e.target.name == "height") {
                    this.props.onRatiochange(null, e.target.value);
                }
            }

            render() {
                return (
                    <div className="columns is-gapless">
                        <div className="column">
                            <label className="label">The Screen Size Ratio:</label>                      
                            <div className="columns">
                                <div className="column">                                  
                                    <input className="input" type="text" placeholder="Width" name="width" onChange={this.handleChange}/>
                                </div>
                                <div className="column">
                                    <input className="input" type="text" placeholder="Height" name="height" onChange={this.handleChange}/>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class CalculateButton extends React.Component {
            constructor(props) {
                super(props);
                this.handleClick = this.handleClick.bind(this);
            }

            handleClick(e) {
                this.props.onClick(e.target.id);
            }

            render() {
                return (
                    <div className="level">
                        <div className="level-left">                            
                            <div className="level-item">
                                <a id="calculateButton" className="button is-primary" onClick={this.handleClick}>Calculate</a>
                            </div>
                        </div>
                        <div className="level-right">
                        </div>    
                    </div>
                );
            }
        }

        class Chart extends React.Component {
            render() {
                const chartStyle = { height : 13.6 + 'rem' };

                return (
                    <div className="box" style={ chartStyle }>
                    </div>
                );
            }
        }

        class ResultText extends React.Component {
            render() {
                const spanStyle = { marginRight : 1.4 + 'rem' };
                const width = this.props.width;
                const height = this.props.height;
                return (
                    <div className="level">
                        <div className="level-item has-text-centered">
                            <div>
                                <span style={ spanStyle }><strong>Width : </strong><span id="widthResult">{width}</span> cm</span>
                                <span><strong>Height : </strong><span id="heightResult">{height}</span> cm</span>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class ResultContainer extends React.Component {
            calculate(screenSize, widthRatio, heightRatio) {
                const size = screenSize;
                const ratio =  widthRatio / heightRatio;
                const height = Math.sqrt((screenSize * screenSize)/(1 + ratio*ratio));
                const width = height * ratio;

                return {width:width, height:height}
            }

            inchToMeter(value) {
                return value * 2.54;
            }

            render() {
                const screenSize = this.props.screenSize;
                const widthRatio = this.props.widthRatio;
                const heightRatio = this.props.heightRatio;
                let width = 0;
                let height = 0;

                if(screenSize != null && widthRatio != null && heightRatio != null) {
                    const result = this.calculate(screenSize, widthRatio, heightRatio);
                    width = this.inchToMeter(result.width).toFixed(2);
                    height = this.inchToMeter(result.height).toFixed(2);
                }

                return (
                    <div>
                        <Chart width={width} height={height} />
                        <ResultText width={width} height={height} />
                    </div>
                );
            }
        }

        class InputContainer extends React.Component {
            constructor(props) {
                super(props);
                this.state = {screenSize : '0',
                                widthRatio : '0',
                                heightRatio : '0'};
                this.handleSizeChange = this.handleSizeChange.bind(this);
                this.handleRatioChange = this.handleRatioChange.bind(this);
                this.handleCalculate = this.handleCalculate.bind(this);
            }

            handleSizeChange(size) {
                this.setState({screenSize : size});
            }

            handleRatioChange(widthRatio, heightratio) {
                if(widthRatio != null) {
                    this.setState({widthRatio : widthRatio});
                }
                if(heightratio != null) {
                    this.setState({heightRatio : heightratio});
                }
            }

            handleCalculate(id) {
                this.props.onClickCalculate(id, this.state.screenSize, this.state.widthRatio, this.state.heightRatio);              
            }

            render() {
                const screenSize = this.state.screenSize;
                const widthRatio = this.state.widthRatio;
                const heightRatio = this.state.heightRatio;

                return (
                    <div>
                        <SreenSizeInput onSizeChange={this.handleSizeChange}/>
                        <ScreenSizeRatioInput onRatiochange={this.handleRatioChange}/>
                        <CalculateButton onClick={this.handleCalculate}/>
                    </div>
                );
            }
        }

        class CalculatorContainer extends React.Component {
            constructor(props) {
                super(props);
                this.state = {calculateCount: 0};
                this.plotChart = this.plotChart.bind(this);
            }

            plotChart(id, screenSize, widthRatio, heightRatio) {
                ReactDOM.render(
                    <ResultContainer screenSize={screenSize} 
                                     widthRatio={widthRatio} 
                                     heightRatio={heightRatio}/>,
                    document.getElementById('chartDiv')
                );
            }

            render() {
                return (
                    <div>
                        <div className="columns">
                            <div className="column is-5">
                                <InputContainer onClickCalculate={this.plotChart}/>
                            </div>
                            <div id="chartDiv" className="column is-7">
                                <ResultContainer />
                            </div>
                        </div>
                    </div>
                );
            }
        }

        class FooterSection extends React.Component {
            render() {
                var style = {paddingTop: 1.5 + 'rem', paddingBottom: 1.5 + 'rem'};
                return (
                    <footer className="footer" style = { style }>
                        <div className="content has-text-centered">
                            <p>
                            <strong>A Work</strong> by <a href="https://github.com/yangyangxian">Yang Yang</a>. CSS style powered by <a href="https://bulma.io/">Bulma</a>
                            </p>
                        </div>
                    </footer>
                );
            }
        }

        ReactDOM.render(
            <HearSection />,
            document.getElementById('header')
        );

        ReactDOM.render(
            <CalculatorContainer />,
            document.getElementById('content')
        );

        ReactDOM.render(
            <FooterSection />,
            document.getElementById('footer')
        );

    </script>
  </body>
</html>